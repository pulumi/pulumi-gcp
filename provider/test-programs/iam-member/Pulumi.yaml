name: iam-member
runtime: yaml
description: A minimal Pulumi YAML program
config:
  serviceID:
    type: string
    default: service-id-iam-member
resources:
  customRole:
    type: gcp:projects:IAMCustomRole
    properties:
      title: CustomRole
      roleId: customRoleId
      permissions:
        - resourcemanager.projects.get

  serviceAccount:
    type: gcp:serviceaccount:Account
    properties:
      accountId: ${serviceID}

  serviceAccountIAMMember:
    type: gcp:serviceaccount:IAMMember
    properties:
      serviceAccountId: ${serviceAccount.name}
      role: ${customRole.id}
      member: serviceAccount:${serviceAccount.email}
  projectIAMMember:
    type: gcp:projects:IAMMember 
    properties:
      role: ${customRole.id}
      member: serviceAccount:${serviceAccount.email}
      project: ${gcp:project}
